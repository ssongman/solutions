

# GatewayAPI





# 1. ê°œìš”

Kubernetes **Ingress**ì™€ ìƒˆë¡­ê²Œ ë“±ì¥í•œ **Gateway API**ëŠ” ì¿ ë²„ë„¤í‹°ìŠ¤ ë„¤íŠ¸ì›Œí¬ ì§„í™” ê³¼ì •ì—ì„œ ì¤‘ìš”í•œ ë³€í™” í¬ì¸íŠ¸ì´ë‹¤.

Ingress ëŠ” Kubernetes ì´ˆê¸° L7 íŠ¸ë˜í”½ ì§„ì…ì  í‘œì¤€ API ì´ë©° ì£¼ë¡œ http/https ë¼ìš°íŒ… ì¤‘ì‹¬ìœ¼ë¡œ ê¸°ëŠ¥ì´ ì œí•œì ì´ì˜€ë‹¤.

Gateway API ëŠ” Ingress ì˜ ì°¨ì„¸ëŒ€ ëŒ€ì²´ í‘œì¤€ìœ¼ë¡œ CNCF/ì¿ ë²„ë„¤í‹°ìŠ¤ SIG-Network ì—ì„œ ê°œë°œì¤‘ì´ë©° L4/L7 ëª¨ë‘ ì§€ì›í•˜ë©° APIê°€ ì„¸ë¶„í™”(tcp/udp/http/grpc route)ëœë‹¤.





## 1) ê¸°ì¡´ Ingress ì™€ Gateway API ë¹„êµ



| **í•­ëª©**      | **Ingress**                                 | **Gateway API**                                              |
| ------------- | ------------------------------------------- | ------------------------------------------------------------ |
| ë¦¬ì†ŒìŠ¤ íƒ€ì…   | Ingress í•˜ë‚˜                                | GatewayClass, Gateway, HTTPRoute ë“± ì—¬ëŸ¬ ë¦¬ì†ŒìŠ¤ë¡œ ë¶„ë¦¬       |
| í‘œí˜„ë ¥        | ì£¼ë¡œ L7 HTTP(S) ë¼ìš°íŒ…ë§Œ ì§€ì›               | L4/L7 ë¼ìš°íŒ… ëª¨ë‘ ì§€ì› (TCP, UDP, HTTP, gRPC ë“±)             |
| í™•ì¥ì„±        | Controller êµ¬í˜„ì²´ë§ˆë‹¤ ì£¼ì„(Annotation) ë‚¨ë°œ | **í‘œì¤€í™”ëœ í•„ë“œ** ì œê³µ â†’ ë²¤ë”/ì»¨íŠ¸ë¡¤ëŸ¬ê°„ ì¼ê´€ì„±              |
| ë©€í‹°í…Œë„Œì‹œ    | ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ë‹¨ìœ„ ê²©ë¦¬ í•œê³„                 | Gatewayì™€ Route ë¦¬ì†ŒìŠ¤ë¥¼ ë‚˜ëˆ  ë‹¤ìˆ˜ íŒ€/ì„œë¹„ìŠ¤ì—ì„œ ì•ˆì „í•˜ê²Œ ê³µìœ  ê°€ëŠ¥ |
| CRD ê¸°ë°˜ í™•ì¥ | ì œí•œì                                       | CRD ê¸°ë°˜ìœ¼ë¡œ í™•ì¥ì„± ë‚´ì¥ (ì»¤ìŠ¤í…€ í•„ë“œ ë¶ˆí•„ìš”)                |

### í•µì‹¬ í¬ì¸íŠ¸

- **IngressëŠ” ë‹¨ìˆœ HTTP ë¼ìš°íŒ… ì¤‘ì‹¬** (êµ¬ì‹ API)
- **Gateway APIëŠ” ì°¨ì„¸ëŒ€ ë„¤íŠ¸ì›Œí¬ API** â†’ ë©€í‹°í…Œë„Œì‹œ, ë‹¤ì–‘í•œ í”„ë¡œí† ì½œ ì§€ì›, CRD í™•ì¥ì„±
- CNCF ë° ì£¼ìš” ë²¤ë”(NGINX, Istio, Envoy, Azure ë“±)ì—ì„œ **Ingressë¥¼ ëŒ€ì²´í•  í‘œì¤€**ìœ¼ë¡œ ì¶”ì§„ ì¤‘



## 2) Gateway API ì£¼ìš” ë¦¬ì†ŒìŠ¤

###  Gateway Controller

- Gateway API ë¦¬ì†ŒìŠ¤ë¥¼ **ì‹¤ì œë¡œ ë™ì‘**í•˜ê²Œ ë§Œë“œëŠ” ì»¨íŠ¸ë¡¤ëŸ¬(ì†Œí”„íŠ¸ì›¨ì–´).

- ì˜ˆì‹œ: Envoy Gateway, Istio, NGINX, AKS Application Gateway Controller ë“±.

- GatewayClassì— controllerNameì„ ì§€ì •í•˜ë©´, í•´ë‹¹ ì»¨íŠ¸ë¡¤ëŸ¬ê°€ ìì‹ ì´ ê´€ë¦¬í•´ì•¼ í•  ë¦¬ì†ŒìŠ¤ë¥¼ â€œClaimâ€í•´ì„œ ë™ì‘í•©ë‹ˆë‹¤.

  

### GatewayClass

- í´ëŸ¬ìŠ¤í„°ì—ì„œ ì‚¬ìš©í•  Gateway êµ¬í˜„ì²´ë¥¼ ì •ì˜ (ì˜ˆ: Istio, NGINX, Envoy, AKS Application Gateway ë“±).
- â€œì´ ì»¨íŠ¸ë¡¤ëŸ¬ê°€ Gatewayë¥¼ ì²˜ë¦¬í•  ê±°ì•¼â€ ë¼ëŠ” ì„ ì–¸.



### Gateway

- íŠ¹ì • GatewayClassë¥¼ ê¸°ë°˜ìœ¼ë¡œ, ì‹¤ì œ **Load Balancerë‚˜ Listener ë¦¬ì†ŒìŠ¤**ë¥¼ í”„ë¡œë¹„ì €ë‹ (í¬íŠ¸, í”„ë¡œí† ì½œ, ì¸ì¦ì„œ ë“±).
- ì‹¤ì œ íŠ¸ë˜í”½ì´ ë“¤ì–´ì˜¤ëŠ” ì§„ì…ì (Load Balancer, NodePort ë“±).
- ì–´ë–¤ GatewayClassë¥¼ ì“¸ ê±´ì§€, ì–´ë–¤ í¬íŠ¸/í”„ë¡œí† ì½œì„ ë°›ì„ ê±´ì§€ ì •ì˜.



### Route

- íŠ¸ë˜í”½ ë¼ìš°íŒ… ê·œì¹™ ì •ì˜.
- HTTPRoute, TCPRoute, UDPRoute, GRPCRoute ì§€ì›.
- ì„œë¹„ìŠ¤ì™€ ì—°ê²°ë˜ì–´ íŠ¸ë˜í”½ ë¶„ë°°.
- ì–´ë–¤ Gatewayì— ë¶™ì–´ì„œ ì–´ë–¤ Host/Path/Portë¡œ ë“¤ì–´ì˜¨ ìš”ì²­ì„ ì–´ë–¤ Serviceë¡œ ë³´ë‚¼ì§€ ì •ì˜.





```mermaid
flowchart TD

Client["ì‚¬ìš©ì íŠ¸ë˜í”½"] -->|"Ingress L4/L7"| GW["Gateway"]

subgraph Cluster["Kubernetes Cluster"]
  subgraph GatewayAPI["Gateway API Resources"]
    GC["GatewayClass"] --> GW["Gateway"]
    GW --> HR["HTTPRoute"]
    HR --> SVC1["Service A"]
    HR --> SVC2["Service B"]
  end
end

GWController["Gateway Controller (Envoy/NGINX/Istio/AppGW)"] --- GC
```







## 3) ì˜ˆì‹œ (Gateway API)

```
apiVersion: gateway.networking.k8s.io/v1
kind: GatewayClass
metadata:
  name: nginx
spec:
  controllerName: k8s.io/ingress-nginx
---
apiVersion: gateway.networking.k8s.io/v1
kind: Gateway
metadata:
  name: web-gateway
  namespace: default
spec:
  gatewayClassName: nginx
  listeners:
  - name: http
    protocol: HTTP
    port: 80
---
apiVersion: gateway.networking.k8s.io/v1
kind: HTTPRoute
metadata:
  name: web-route
  namespace: default
spec:
  parentRefs:
  - name: web-gateway
  rules:
  - matches:
    - path:
        type: PathPrefix
        value: /app
    backendRefs:
    - name: my-service
      port: 80
```

â¡ï¸ ìœ„ ì˜ˆì œëŠ”

- nginx GatewayClassë¥¼ ì“°ê³ ,
- web-gatewayì—ì„œ 80í¬íŠ¸ HTTP ë¦¬ìŠ¤ë‹,
- /app ìš”ì²­ì€ my-service ë¡œ ë¼ìš°íŒ…í•œë‹¤ëŠ” ì˜ë¯¸ì˜ˆìš”.





## 4) Azure (AKS)ì—ì„œì˜ Gateway API



- AKSì—ì„œëŠ” **Application Gateway Ingress Controller (AGIC)** ê°€ ê¸°ì¡´ Ingressë¥¼ ì§€ì›í–ˆìŒ
- ìµœê·¼ì—ëŠ” **Gateway API ê¸°ë°˜ Application Gateway Controller** ë¡œ ë°œì „ ì¤‘
- ì¦‰, **Gateway APIë¥¼ ì“°ë©´ Ingressë³´ë‹¤ ë” ê°•ë ¥í•œ ë¼ìš°íŒ…/ë³´ì•ˆ ì •ì±…**ì„ Azure ë„¤ì´í‹°ë¸Œí•˜ê²Œ ì ìš©í•  ìˆ˜ ìˆìŒ





# 2. AKSì—ì„œ Gateway API ì„¤ì •

AKSì— ì²˜ìŒ í´ëŸ¬ìŠ¤í„°ë¥¼ ë§Œë“¤ê³  ë°”ë¡œ **Gateway API**ë¥¼ ì„¤ì •í•˜ëŠ” ë°©ë²•ì„ ì•Œì•„ë³´ì.



## 1) AKS í´ëŸ¬ìŠ¤í„° ìƒì„±

```sh

# ë¦¬ì†ŒìŠ¤ê·¸ë£¹ ìƒì„±
$  az group list -o table
Name                                                                   Location      Status
---------------------------------------------------------------------  ------------  ---------
rg-az01-poc-cloudautomation-sh-01                                      koreacentral  Succeeded
rg-az01-poc-cloudautomation-jw-01                                      koreacentral  Succeeded
rg-az01-poc-cloudautomation-dh-01                                      koreacentral  Succeeded
rg-az01-poc-cloudautomation-ck-01                                      koreacentral  Succeeded
rg-az01-poc-cloudautomation-ww-01                                      koreacentral  Succeeded
MC-rg-az01-poc-cloudautomation-ww-01                                   koreacentral  Succeeded
MA_defaultazuremonitorworkspace-se_koreacentral_managed                koreacentral  Succeeded
rg-az01-poc-cloudautomation-jy-01                                      koreacentral  Succeeded
MC_rg-az01-poc-cloudautomation-jy-01_aks-az01-dev-jytest_koreacentral  koreacentral  Succeeded


$ az group create \
  -n rg-az01-ca-yj01 \
  -l koreacentral \
  --tags EMAIL='yj.song@kt.com' \
         ServiceName='cloud-automation' \
         Name='songyangjong' \
         CreateDate='2025-09-05'


$  az group list -o table
Name                                                                   Location      Status
---------------------------------------------------------------------  ------------  ---------
...
rg-az01-ca-yj01                                                        koreacentral  Succeeded




  
# AKS ëª©ë¡
$ az aks list -o table
Name                                        Location      ResourceGroup                      KubernetesVersion    CurrentKubernetesVersion    ProvisioningState    Fqdn
------------------------------------------  ------------  ---------------------------------  -------------------  --------------------------  -------------------  ----------------------------------------------------------------------
aks-az01-poc-cloudautomation-monitoring-01  koreacentral  rg-az01-poc-cloudautomation-ww-01  1.31                 1.31.7                      Succeeded            aks-az01-p-rg-az01-poc-clou-0597e2-2bpqt8hq.hcp.koreacentral.azmk8s.io
aks-az01-dev-jytest                         koreacentral  rg-az01-poc-cloudautomation-jy-01  1.32                 1.32.5                      Succeeded            aks-az01-d-rg-az01-poc-clou-0597e2-5f1r3ne3.hcp.koreacentral.azmk8s.io


# AKS ìƒì„±
$ az aks create \
  -g rg-az01-ca-yj01 \
  -n aks-az01-ca-yj-01 \
  --node-count 2 \
  --enable-managed-identity \
  --network-plugin azure \
  --network-plugin-mode overlay \
  --pod-cidr 10.244.0.0/16 \
  --service-cidr 10.0.0.0/16 \
  --dns-service-ip 10.0.0.10 \
  --generate-ssh-keys




```

í´ëŸ¬ìŠ¤í„° ì—°ê²°:

```sh

$ az aks get-credentials -g rg-az01-ca-yj01 -n aks-az01-ca-yj-01

$ kubectl config get-contexts
CURRENT   NAME                        CLUSTER                     AUTHINFO                                                    NAMESPACE
*         aks-az01-ca-yj-01           aks-az01-ca-yj-01           clusterUser_rg-az01-ca-yj01_aks-az01-ca-yj-01
          aks-az01-cloudbiz-comm-01   aks-az01-cloudbiz-comm-01   clusterUser_rg-cloudbiz-comm-01_aks-az01-cloudbiz-comm-01   temp

```



## 2) Gateway API CRD ì„¤ì¹˜



Gateway APIëŠ” Kubernetesì˜ í™•ì¥ ë¦¬ì†ŒìŠ¤ì´ë¯€ë¡œ CRD(CustomResourceDefinition)ë¥¼ ì„¤ì¹˜í•´ì•¼ í•œë‹¤.

```sh

# 1. standard ì„¤ì¹˜
$ kubectl apply -f https://github.com/kubernetes-sigs/gateway-api/releases/download/v1.1.0/standard-install.yaml

customresourcedefinition.apiextensions.k8s.io/gatewayclasses.gateway.networking.k8s.io created
customresourcedefinition.apiextensions.k8s.io/gateways.gateway.networking.k8s.io created
customresourcedefinition.apiextensions.k8s.io/grpcroutes.gateway.networking.k8s.io created
customresourcedefinition.apiextensions.k8s.io/httproutes.gateway.networking.k8s.io created
customresourcedefinition.apiextensions.k8s.io/referencegrants.gateway.networking.k8s.io created


# 2. experimental
$ kubectl apply -f https://github.com/kubernetes-sigs/gateway-api/releases/download/v1.1.0/experimental-install.yaml

customresourcedefinition.apiextensions.k8s.io/backendlbpolicies.gateway.networking.k8s.io created
customresourcedefinition.apiextensions.k8s.io/backendtlspolicies.gateway.networking.k8s.io created
customresourcedefinition.apiextensions.k8s.io/gatewayclasses.gateway.networking.k8s.io configured
customresourcedefinition.apiextensions.k8s.io/gateways.gateway.networking.k8s.io configured
customresourcedefinition.apiextensions.k8s.io/grpcroutes.gateway.networking.k8s.io configured
customresourcedefinition.apiextensions.k8s.io/httproutes.gateway.networking.k8s.io configured
customresourcedefinition.apiextensions.k8s.io/referencegrants.gateway.networking.k8s.io configured
customresourcedefinition.apiextensions.k8s.io/tcproutes.gateway.networking.k8s.io created
customresourcedefinition.apiextensions.k8s.io/tlsroutes.gateway.networking.k8s.io created
customresourcedefinition.apiextensions.k8s.io/udproutes.gateway.networking.k8s.io created



# í™•ì¸
$ kubectl get crd | grep gateway
backendlbpolicies.gateway.networking.k8s.io      2025-09-05T05:33:55Z
backendtlspolicies.gateway.networking.k8s.io     2025-09-05T05:33:55Z
gatewayclasses.gateway.networking.k8s.io         2025-09-05T05:30:25Z
gateways.gateway.networking.k8s.io               2025-09-05T05:30:25Z
grpcroutes.gateway.networking.k8s.io             2025-09-05T05:30:25Z
httproutes.gateway.networking.k8s.io             2025-09-05T05:30:26Z
referencegrants.gateway.networking.k8s.io        2025-09-05T05:30:26Z
tcproutes.gateway.networking.k8s.io              2025-09-05T05:33:56Z
tlsroutes.gateway.networking.k8s.io              2025-09-05T05:33:57Z
udproutes.gateway.networking.k8s.io              2025-09-05T05:33:57Z




```





## 3) Gateway Controller ë°°í¬



Gateway APIëŠ” **ì»¨íŠ¸ë¡¤ëŸ¬ê°€ í•„ìˆ˜**ì˜ˆìš”. (Ingress Controllerì²˜ëŸ¼).

ì˜ˆì‹œ: **Envoy Gateway**ë¥¼ ì„¤ì¹˜í•œë‹¤ê³  ê°€ì •.

```sh

$ kubectl apply -f https://github.com/envoyproxy/gateway/releases/download/v0.6.0/install.yaml

# í™•ì¸

$ kubectl get pods -n envoy-gateway-system
NAME                             READY   STATUS              RESTARTS   AGE
eg-gateway-helm-certgen-vqcfn    0/1     ContainerCreating   0          2s
envoy-gateway-5bbf64bb74-kr2f7   0/1     ContainerCreating   0          3s


```





## 4) GatewayClass ìƒì„±



```sh

$ echo '
apiVersion: gateway.networking.k8s.io/v1
kind: GatewayClass
metadata:
  name: envoy
spec:
  controllerName: gateway.envoyproxy.io/gatewayclass-controller
' | kubectl apply -f -


# í™•ì¸
$ kubectl get GatewayClass
NAME    CONTROLLER                                      ACCEPTED   AGE
envoy   gateway.envoyproxy.io/gatewayclass-controller   True       24s


```



## 5) Gateway ë¦¬ì†ŒìŠ¤ ìƒì„±

```sh

$ echo '
apiVersion: gateway.networking.k8s.io/v1
kind: Gateway
metadata:
  name: my-gateway
  namespace: default
spec:
  gatewayClassName: envoy
  listeners:
  - name: http
    protocol: HTTP
    port: 80
' | kubectl apply -f -


# í™•ì¸
$ kubectl get Gateway
NAME         CLASS   ADDRESS          PROGRAMMED   AGE
my-gateway   envoy   20.249.157.253   True         14s


```





## 6) Route ë¦¬ì†ŒìŠ¤ ìƒì„± (ì˜ˆ: HTTPRoute)



```sh


$ echo '
apiVersion: gateway.networking.k8s.io/v1
kind: HTTPRoute
metadata:
  name: my-route
  namespace: default
spec:
  parentRefs:
  - name: my-gateway
  rules:
  - matches:
    - path:
        type: PathPrefix
        value: /
    backendRefs:
    - name: my-service
      port: 80
' | kubectl apply -f -


# í™•ì¸
$ kubectl get HTTPRoute
NAME       HOSTNAMES   AGE
my-route               13s


```



## 7) í…ŒìŠ¤íŠ¸

```sh

$ kubectl get svc -n envoy-gateway-system
NAME                                TYPE           CLUSTER-IP     EXTERNAL-IP      PORT(S)               AGE
envoy-default-my-gateway-1c7c06f0   LoadBalancer   10.0.83.114    20.249.157.253   80:30622/TCP          104s
envoy-gateway                       ClusterIP      10.0.137.179   <none>           18000/TCP,18001/TCP   4m31s
envoy-gateway-metrics-service       ClusterIP      10.0.6.30      <none>           19001/TCP             4m31s


```

LoadBalancer IP í™•ì¸ í›„ ë¸Œë¼ìš°ì €ì—ì„œ í…ŒìŠ¤íŠ¸.





# 3. DB Connect Test



**ë‚´ ë¡œì»¬ PC â†’ AKS (ë˜ëŠ” K8s) ë‚´ë¶€ Postgres â†’ Gateway API (L4) ê²½ìœ **ë¡œ ì—°ê²°ì„ í™•ì¸



ì¢‹ìŠµë‹ˆë‹¤ ğŸ‘

ì •ë¦¬í•˜ë©´, ëª©í‘œëŠ” **ë‚´ ë¡œì»¬ PC â†’ AKS (ë˜ëŠ” K8s) ë‚´ë¶€ Postgres â†’ Gateway API (L4) ê²½ìœ **ë¡œ ì—°ê²°ì„ í™•ì¸í•˜ëŠ” ê±°êµ°ìš”.



------





## **1. PostgreSQL ì„¤ì¹˜ (Helm)**



K8s ì•ˆì— PostgreSQLì„ ì„¤ì¹˜

```sh
helm repo add bitnami https://charts.bitnami.com/bitnami
helm repo update

# PostgreSQL ì„¤ì¹˜
helm install my-postgres bitnami/postgresql \
  --set auth.username=testuser \
  --set auth.password=testpass \
  --set auth.database=testdb \
  --set primary.service.ports.postgresql=5432


$ kubectl get svc -l app.kubernetes.io/name=postgresql
NAME                        TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)    AGE
my-postgres-postgresql      ClusterIP   10.0.239.231   <none>        5432/TCP   14s
my-postgres-postgresql-hl   ClusterIP   None           <none>        5432/TCP   14s


```







## **2. Gateway API ë¦¬ì†ŒìŠ¤ ìƒì„± (TCPRoute)**



### **(1) GatewayClass**



```sh

$ echo '
apiVersion: gateway.networking.k8s.io/v1
kind: GatewayClass
metadata:
  name: envoy
spec:
  controllerName: gateway.envoyproxy.io/gatewayclass-controller
' | kubectl apply -f -


# í™•ì¸
$ kubectl get GatewayClass
NAME    CONTROLLER                                      ACCEPTED   AGE
envoy   gateway.envoyproxy.io/gatewayclass-controller   True       19m

  
```



### **(2) Gateway**



```sh

$ echo '
apiVersion: gateway.networking.k8s.io/v1
kind: Gateway
metadata:
  name: postgres-gateway
  namespace: default
spec:
  gatewayClassName: envoy
  listeners:
    - name: postgres
      protocol: TCP
      port: 5432
      allowedRoutes:
        namespaces:
          from: Same
' | kubectl apply -f -


# í™•ì¸
$ kubectl get Gateway
NAME               CLASS   ADDRESS          PROGRAMMED   AGE
my-gateway         envoy   20.249.157.253   True         19m
postgres-gateway   envoy   20.249.165.22    False        14s

```



### **(3) TCPRoute**



```sh

$ echo '
apiVersion: gateway.networking.k8s.io/v1alpha2
kind: TCPRoute
metadata:
  name: postgres-route
  namespace: default
spec:
  parentRefs:
    - name: postgres-gateway
      sectionName: postgres
  rules:
    - backendRefs:
        - name: my-postgres
          port: 5432
' | kubectl apply -f -


# í™•ì¸
$ kubectl get TCPRoute
NAME             AGE
postgres-route   4s

```





## **3. ì™¸ë¶€ ì§„ì…ì  í™•ì¸**



Gateway ë¦¬ì†ŒìŠ¤ì— External IPê°€ í• ë‹¹ë©ë‹ˆë‹¤.

í™•ì¸:

```

kubectl get gateway postgres-gateway -o wide
NAME               CLASS   ADDRESS         PROGRAMMED   AGE
postgres-gateway   envoy   20.249.165.22   True         62s


```





## **4. ë¡œì»¬ PCì—ì„œ PostgreSQL Client ì‹¤í–‰**



### (1) Dockerë¡œ ì‹¤í–‰

```
$ docker run -it --rm postgres:16 psql \
  -h 20.249.165.22 -p 5432 -U testuser -d testdb


psql: error: connection to server at "20.249.165.22", port 5432 failed: Connection refused
        Is the server running on that host and accepting TCP/IP connections?


psql (16.0)
Type "help" for help.

testdb=>

```





## **5. êµ¬ì¡° ìš”ì•½ (Mermaid)**



```mermaid
flowchart LR
    PC["ë¡œì»¬ PC (psql client, Docker)"] --> |TCP 5432| GW["Gateway (TCP Listener)"] --> SVC["K8s Service (my-postgres)"] --> DB["Postgres Pod"]
```

ì™¸ë¶€ì—ì„œ Gateway APIë¥¼ í†µí•´ **L4 (TCP) íŠ¸ë˜í”½**ìœ¼ë¡œ PostgreSQL DB ì—°ê²° í…ŒìŠ¤íŠ¸ê°€ ê°€ëŠ¥



