# Alertmanager ì„¤ì •



# 1. ê°œìš”

íŠ¹ì • AP Podì˜ CPU ì‚¬ìš©ë¥ ì´ ì¼ì • ì„ê³„ì¹˜ë¥¼ ì´ˆê³¼í–ˆì„ ë•Œ, Alertmanagerê°€ Mattermostë¡œ ì•Œë¦¼ì„ ë³´ë‚´ëŠ” ê²ƒì„ ê°€ì´ë“œí•œë‹¤.



## 1) êµ¬ì„±

AP CPU ê²½ê³  â†’ Mattermost ì•Œë¦¼ êµ¬ì„± ê°€ì´ë“œ

```
[AP Pod Metrics] â†’ [Prometheus] â†’ [Alert Trigger] â†’ [Alertmanager] â†’ [Mattermost Webhook]
```









# 2. Mattermost Webhook

Prometheus Alertmanager ë“± ì™¸ë¶€ ì‹œìŠ¤í…œì—ì„œ Mattermost ì±„ë„ë¡œ ì•Œë¦¼ì„ ì „ì†¡í•  ìˆ˜ ìˆë„ë¡ **Incoming Webhook URL**ì„ ìƒì„±í•œë‹¤.



## 1) Webhook ìƒì„±





### (1) Incoming Webhook í™œì„±í™” ì„¤ì •

* ë©”ë‰´ : ê´€ë¦¬ìë„êµ¬ > í†µí•© > í†µí•©ê´€ë¦¬
  * Incoming Webhook : í™œì„±í™”



### (2) ì±„ë„ ìƒì„±

* ë©”ë‰´ : Mattermost ì±„ë„ ì„ íƒ
  * Add-channels : monitoring-alerts



### (3) Webhook ìƒì„±

* ë©”ë‰´ : Mattermost(ì¢Œì¸¡ìƒë‹¨) í´ë¦­ > í†µí•© > ì „ì²´ Incoming Webhook > incoming Webhook ì¶”ê°€í•˜ê¸°

| **í•­ëª©**        | **ì…ë ¥ ì˜ˆì‹œ**      |
| --------------- | ------------------ |
| **Title**       | Prometheus Alert   |
| **Description** | ì•Œë¦¼ìš© Webhook     |
| **Channel**     | #monitoring-alerts |
| ì´ì±„ë„ë¡œ ê³ ì •   | Check              |



* ìƒì„±ë²„íŠ¼ í´ë¦­

  * ìƒì„± ì™„ë£Œ ì‹œ ë‹¤ìŒê³¼ ê°™ì€ **Webhook URL**ì´ ìƒì„±

    * ```
      https://mattermost.example.com/hooks/xxxx-yyy-zzz
      ```

    * 

  * **Webhook URL** ë³´ê´€í• ê²ƒ



### (4) Webhook Test



#### test1

```sh
https://mm.cbiz.kubepia.net/hooks/795ruu4wzb8spgfkd1hw4j7fta

$ curl -X POST \
  -H 'Content-Type: application/json' \
  -d '{"text":"ğŸ”” í…ŒìŠ¤íŠ¸ ì•Œë¦¼ì…ë‹ˆë‹¤! Mattermost Webhook ì—°ê²° ì„±ê³µ"}' \
  https://mm.cbiz.kubepia.net/hooks/795ruu4wzb8spgfkd1hw4j7fta



ğŸ”” í…ŒìŠ¤íŠ¸ ì•Œë¦¼ì…ë‹ˆë‹¤! Mattermost Webhook ì—°ê²° ì„±ê³µ
```



#### test2

```sh
$ curl -X POST -H 'Content-Type: application/json' \
  -d '{
    "username": "alert-bot",
    "icon_url": "https://www.clipartmax.com/png/full/150-1502115_alarm-icon-red-alert-icon.png",
    "text": ":rotating_light: **TEST ALERT**\n\nCPU usage exceeded 90% on `ap-pod-1`."
  }' \
  https://mm.cbiz.kubepia.net/hooks/795ruu4wzb8spgfkd1hw4j7fta
  


:rotating_light: TEST ALERT
CPU usage exceeded 90% on ap-pod-1.





$ curl -X POST -H 'Content-Type: application/json' \
  -d '{"text":"[FIRING] High CPU usage\nâ€¢ pod-nameì˜ CPU ì‚¬ìš©ë¥ ì´ 90%ì…ë‹ˆë‹¤."}' \
  https://mm.cbiz.kubepia.net/hooks/795ruu4wzb8spgfkd1hw4j7fta

[FIRING] High CPU usage
â€¢ pod-nameì˜ CPU ì‚¬ìš©ë¥ ì´ 90%ì…ë‹ˆë‹¤.

```



| **í•„ë“œ** | **ì„¤ëª…**                             |
| -------- | ------------------------------------ |
| username | ë©”ì‹œì§€ë¥¼ ë³´ë‚¼ ë´‡ ì´ë¦„                |
| icon_url | ë´‡ ì•„ì´ì½˜ ì´ë¯¸ì§€ URL                 |
| text     | ì‹¤ì œ ë©”ì‹œì§€ í…ìŠ¤íŠ¸ (markdown ì§€ì›ë¨) |











# 3. Alertmanager ì„¤ì •



Alertmanager ë¦¬ì†ŒìŠ¤ë¥¼ ìƒì„±í• ë•ŒëŠ” Secret ì„ ì´ìš©í•œë‹¤.

ì „ìš© secret ì´ ìˆìœ¼ë¯€ë¡œ í•´ë‹¹ secret ì„ ì‚­ì œí›„ ë‹¤ì‹œ ìƒì„±í•œë‹¤.





## 1) alertmanager.yml ê¸°ë³¸

Mattermostë¡œ ì•Œë¦¼ì„ ë³´ë‚´ë ¤ë©´ Alertmanagerì˜ `receivers` ì„¹ì…˜ì— Mattermost ì„¤ì •ì„ ì¶”ê°€í•´ì•¼ í•œë‹¤.

ì´ ë¦¬ì‹œë²„ë¥¼ ì‚¬ìš©í•  `route`ë¥¼ ì •ì˜í•´ì„œ íŠ¹ì • ì•Œë¦¼ì´ Mattermostë¡œ ì „ë‹¬ë˜ë„ë¡ êµ¬ì„±í•´ì•¼ í•œë‹¤.



### (1) ê¸°ë³¸ì ì¸ `alertmanager.yml` êµ¬ì„± ì˜ˆì‹œ

```yaml
global:
  # Mattermostë¡œ ë³´ë‚¼ ë•Œ ì‚¬ìš©í•  ê¸°ë³¸ ì„¤ì • (ì„ íƒ ì‚¬í•­)
  # mattermost_api_url: 'your_mattermost_webhook_url'

route:
  group_by: ['alertname']
  group_wait: 30s
  group_interval: 5m
  repeat_interval: 4h
  receiver: 'mattermost-notifications' # ì •ì˜í•  ë¦¬ì‹œë²„ ì´ë¦„

receivers:
- name: 'mattermost-notifications'
  mattermost_configs:
  - api_url: 'your_mattermost_webhook_url' # ì‹¤ì œ Mattermost Webhook URLë¡œ ë³€ê²½
    channel: '#alerts' # ì•Œë¦¼ì„ ë³´ë‚¼ Mattermost ì±„ë„ (ì„ íƒ ì‚¬í•­, ê¸°ë³¸ ì±„ë„ë¡œ ë³´ë‚´ë ¤ë©´ ìƒëµ)
    username: 'Alertmanager' # Mattermostì— í‘œì‹œë  ì•Œë¦¼ ë°œì‹ ì ì´ë¦„ (ì„ íƒ ì‚¬í•­)
    icon_emoji: ':warning:' # Mattermostì— í‘œì‹œë  ì•„ì´ì½˜ ì´ëª¨ì§€ (ì„ íƒ ì‚¬í•­)
    message: |-
      {{ range .Alerts }}
      **Alert:** {{ .Annotations.summary | default .Labels.alertname }}
      **Severity:** {{ .Labels.severity | default "unknown" }}
      **Description:** {{ .Annotations.description | default .Labels.message }}
      **Start Time:** {{ .StartsAt.Local.Format "2006-01-02 15:04:05" }}
      {{ if .EndsAt.IsZero }}{{ else }}**End Time:** {{ .EndsAt.Local.Format "2006-01-02 15:04:05" }}{{ end }}
      {{ if .GeneratorURL }}**Source:** {{ .GeneratorURL }}{{ end }}
      {{ end }}
```



## 2) alertmanager ì„¤ì •



```sh
$ cd ~/song/prom-stack

$ cat > alertmanager.yaml

```

```yaml
$ echo '
global:
  resolve_timeout: 5m
  # slack_api_url: "https://mm.cbiz.kubepia.net/hooks/795ruu4wzb8spgfkd1hw4j7fta"
route:
  receiver: "null"  # ë””í´íŠ¸ëŠ” ë¬´ì‹œ ì²˜ë¦¬
  group_by: ["alertname", "namespace"]
  group_wait: 30s
  group_interval: 5m
  repeat_interval: 4h
  routes:
    - match:
        severity: warning
      receiver: "mattermost"
receivers:
  - name: mattermost
    slack_configs:
      - api_url: "https://mm.cbiz.kubepia.net/hooks/795ruu4wzb8spgfkd1hw4j7fta"
        channel: "#monitoring-alerts"
        send_resolved: true
        title: "{{ .CommonAnnotations.summary }}"
        text: "{{ .CommonAnnotations.description }}"
        #icon_url: 
        #icon_emoji:
  - name: "null"
    webhook_configs: []  # ì•„ë¬´ ì‘ì—…ë„ í•˜ì§€ ì•ŠìŒ
' > alertmanager.yaml


```



```sh
# secret í™•ì¸
$ kubectl -n monitoring get secret
NAME                                                                                  TYPE                 DATA   AGE
alertmanager-prom-stack-kube-prometheus-alertmanager                                  Opaque               1      17h
alertmanager-prom-stack-kube-prometheus-alertmanager-cluster-tls-config               Opaque               1      17h


# ë°˜ë“œì‹œ ì‚­ì œí›„ ë‹¤ì‹œ ìƒì„±
$ kubectl -n monitoring delete secret alertmanager-prom-stack-kube-prometheus-alertmanager

  kubectl -n monitoring create secret generic alertmanager-prom-stack-kube-prometheus-alertmanager \
  --from-file=alertmanager.yaml
  

```



### (1) sample1

```sh
global:
  resolve_timeout: 5m
route:
  group_by: ["alertname"]
  group_wait: 30s
  group_interval: 5m
  repeat_interval: 4h
  routes:
    - match:
        severity: warning     # warning, critical
      receiver: "mattermost-notifications"
    - receiver: "default"     # ë‹¤ë¥¸ ì•Œë¦¼ì„ ì²˜ë¦¬í•  ê¸°ë³¸ ë¦¬ì‹œë²„ (í•„ìš”í•œ ê²½ìš°)
receivers:
  - name: "mattermost-notifications"
    mattermost_configs:
      - api_url: "https://mm.cbiz.kubepia.net/hooks/795ruu4wzb8spgfkd1hw4j7fta"
        channel: "#monitoring-alerts"
  - name: "default"
    # ë‹¤ë¥¸ ì•Œë¦¼ ì²˜ë¦¬ ì„¤ì • (ì˜ˆ: ë¡œê·¸ íŒŒì¼ì— ì €ì¥)
    pass: {}
  
```

*  `severity="warning"` ë ˆì´ë¸”ì„ ê°€ì§„ ì•Œë¦¼ë§Œ Mattermostë¡œ ë³´ë‚´ë„ë¡  `route`ë¥¼ ì„¤ì •í•œë‹¤.



### (2) sample2

```sh
global:
  resolve_timeout: 5m
route:
  receiver: mattermost
  group_by: ["alertname"]
  group_wait: 30s
  group_interval: 5m
  repeat_interval: 1h
receivers:
  - name: mattermost
    webhook_configs:
      - url: "https://mm.cbiz.kubepia.net/hooks/795ruu4wzb8spgfkd1hw4j7fta"
        send_resolved: true
        
  
```

*  `severity="warning"` ë ˆì´ë¸”ì„ ê°€ì§„ ì•Œë¦¼ë§Œ Mattermostë¡œ ë³´ë‚´ë„ë¡  `route`ë¥¼ ì„¤ì •í•œë‹¤.



### (3) sample3

```sh
global:
  resolve_timeout: 5m
  slack_api_url: "https://mm.cbiz.kubepia.net/hooks/795ruu4wzb8spgfkd1hw4j7fta"
route:
  group_by: ["alertname"]
  group_wait: 30s
  group_interval: 5m
  repeat_interval: 4h
  routes:
    - match:
        severity: warning     # warning, critical
      receiver: "mattermost"
    - receiver: "default"     # ë‹¤ë¥¸ ì•Œë¦¼ì„ ì²˜ë¦¬í•  ê¸°ë³¸ ë¦¬ì‹œë²„ (í•„ìš”í•œ ê²½ìš°)
receivers:
  - name: mattermost
    slack_configs:
      - api_url: "https://mm.cbiz.kubepia.net/hooks/795ruu4wzb8spgfkd1hw4j7fta"
        channel: "#monitoring-alerts"
        send_resolved: true
        #icon_url: 
        #icon_emoji: 
  - name: "default"
    # ë‹¤ë¥¸ ì•Œë¦¼ ì²˜ë¦¬ ì„¤ì • (ì˜ˆ: ë¡œê·¸ íŒŒì¼ì— ì €ì¥)
    pass: {}
        
    
    
    


# Whether to notify about resolved alerts.
[ send_resolved: <boolean> | default = false ]

# The Slack webhook URL. Either api_url or api_url_file should be set.
# Defaults to global settings if none are set here.
[ api_url: <secret> | default = global.slack_api_url ]
[ api_url_file: <filepath> | default = global.slack_api_url_file ]

# The channel or user to send notifications to.
channel: <tmpl_string>

# API request data as defined by the Slack webhook API.
[ icon_emoji: <tmpl_string> ]
[ icon_url: <tmpl_string> ]
[ link_names: <boolean> | default = false ]
[ username: <tmpl_string> | default = '{{ template "slack.default.username" . }}' ]
# The following parameters define the attachment.
actions:
  [ <action_config> ... ]
[ callback_id: <tmpl_string> | default = '{{ template "slack.default.callbackid" . }}' ]
[ color: <tmpl_string> | default = '{{ if eq .Status "firing" }}danger{{ else }}good{{ end }}' ]
[ fallback: <tmpl_string> | default = '{{ template "slack.default.fallback" . }}' ]
fields:
  [ <field_config> ... ]
[ footer: <tmpl_string> | default = '{{ template "slack.default.footer" . }}' ]
[ mrkdwn_in: '[' <string>, ... ']' | default = ["fallback", "pretext", "text"] ]
[ pretext: <tmpl_string> | default = '{{ template "slack.default.pretext" . }}' ]
[ short_fields: <boolean> | default = false ]
[ text: <tmpl_string> | default = '{{ template "slack.default.text" . }}' ]
[ title: <tmpl_string> | default = '{{ template "slack.default.title" . }}' ]
[ title_link: <tmpl_string> | default = '{{ template "slack.default.titlelink" . }}' ]
[ image_url: <tmpl_string> ]
[ thumb_url: <tmpl_string> ]

# The HTTP client's configuration.
[ http_config: <http_config> | default = global.http_config ]


```

*  `severity="warning"` ë ˆì´ë¸”ì„ ê°€ì§„ ì•Œë¦¼ë§Œ Mattermostë¡œ ë³´ë‚´ë„ë¡  `route`ë¥¼ ì„¤ì •í•œë‹¤.





### (4) sample4

```sh
global:
  resolve_timeout: 5m
  # slack_api_url: "https://mm.cbiz.kubepia.net/hooks/795ruu4wzb8spgfkd1hw4j7fta"
route:
  group_by: ["alertname"]
  group_wait: 30s
  group_interval: 5m
  repeat_interval: 4h
  routes:
    - match:
        namespace: temp
      receiver: "mattermost"
receivers:
  - name: mattermost
    slack_configs:
      - api_url: "https://mm.cbiz.kubepia.net/hooks/795ruu4wzb8spgfkd1hw4j7fta"
        channel: "#monitoring-alerts"
        send_resolved: true
        #icon_url: 
        #icon_emoji:
```

*  `severity="warning"` ë ˆì´ë¸”ì„ ê°€ì§„ ì•Œë¦¼ë§Œ Mattermostë¡œ ë³´ë‚´ë„ë¡  `route`ë¥¼ ì„¤ì •í•œë‹¤.









# 4. Prometheus Alert Rule ì •ì˜



## (1) CPU AleretRule ì„¤ì •

```sh

$ echo '
apiVersion: monitoring.coreos.com/v1
kind: PrometheusRule
metadata:
  name: ap-cpu-alerts
  labels:
    release: prom-stack   # Helm release name
spec:
  groups:
    - name: ap-cpu.rules
      rules:
        - alert: HighCpuUsage
          expr: sum(rate(container_cpu_usage_seconds_total{namespace="temp", container!="", pod!=""}[1m])) by (pod) > 0.4
          for: 10s
          labels:
            severity: warning
            # namespace: temp
          annotations:
            summary: "CPU ì‚¬ìš©ì´ 0.4 core ì´ˆê³¼ (Pod: {{ $labels.pod }})"
            description: "{{ $labels.pod }}ì˜ CPU ì‚¬ìš©ì´ 0.4coreë¥¼ ì´ˆê³¼í–ˆìŠµë‹ˆë‹¤."
' | kubectl -n monitoring apply -f -


```

* ì¡°ê±´ ì„¤ëª…
  * namespace: "temp" â† ê°ì‹œí•  ë„¤ì„ìŠ¤í˜ì´ìŠ¤
  * CPU ì‚¬ìš©ë¥ : 80% ì´ˆê³¼
  * for: 1m  <-- ì—°ì† 1ë¶„ ì´ìƒ ìœ ì§€ ì‹œ ì•Œë¦¼ ë°œìƒ
  * container!="" ëŠ” POD ì»¨í…Œì´ë„ˆ ì œì™¸ ëª©ì 
* ì£¼ì˜
  * prom-stack ë¼ë²¨ì€ Helm ì„¤ì¹˜ ì´ë¦„ê³¼ ë°˜ë“œì‹œ ì¼ì¹˜í•´ì•¼ Prometheusì— ë°˜ì˜ëœë‹¤.

* ë‹¤ë¥¸ ì‚¬ìš© ê°€ëŠ¥í•œ í…œí”Œë¦¿ ë³€ìˆ˜ë“¤

| **ë³€ìˆ˜**                                      | **ì˜ë¯¸**                          |
| --------------------------------------------- | --------------------------------- |
| {{ .Labels.severity }}                        | Alert Rule ë‚´ ì •ì˜ëœ severity     |
| {{ .Annotations.summary }}                    | summary ë©”ì‹œì§€                    |
| {{ range .Alerts }}{{ .Labels.pod }}{{ end }} | ì—¬ëŸ¬ Alertì—ì„œ pod ì´ë¦„ ë°˜ë³µ ì¶œë ¥ |







#### í™•ì¸

```sh
$ kubectl get prometheusrule -n monitoring
NAME                                                              AGE
ap-cpu-alerts                                                     21s
prom-stack-kube-prometheus-alertmanager.rules                     45m
....


# ì‚­ì œì‹œ...
$ kubectl -n monitoring delete prometheusrule ap-cpu-alerts


```





## (2) ì°¸ê³ 











# 5. ë¶€í•˜ í…ŒìŠ¤íŠ¸

íŠ¹ì • AP Podì— CPU ë¶€í•˜ë¥¼ ì¼ì‹œì ìœ¼ë¡œ ë°œìƒì‹œí‚¨ë‹¤.

## 1) ëŒ€ìƒ AP

```sh

$ echo '
apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app: userlist
  name: userlist
spec:
  replicas: 1
  selector:
    matchLabels:
      app: userlist
  template:
    metadata:
      labels:
        app: userlist
    spec:
      containers:
      - image: ssongman/userlist:v1
        name: userlist
        resources:
          requests:
            cpu: "500m"
            memory: "1Gi"
          limits:
            cpu: "500m"
            memory: "1Gi"
' | kubectl -n temp apply -f -






```



## 2) ë¶€í•˜ìˆ˜í–‰

### (1) ë¶€í•˜1 - curl loop

```sh

$ curl userlist-svc/users/1

# 1ì´ˆì— í•œë²ˆ
$ while true; do curl userlist-svc/users/1; sleep 1; echo ; done

# sleepì—†ì´
$ while true; do curl userlist-svc/users/1; echo ; done

```







### (2) ë¶€í•˜2 - ab

#### ab(apache Bench) ì‹¤í–‰

```sh
# create deploy
$ kubectl -n temp create deploy ab --image=jordi/ab -- sleep 365d



# ì‚­ì œì‹œ...
$ kubectl -n temp delete deploy ab



```

#### ë¶€í•˜ì£¼ê¸° â˜…

ì•„ë˜ ëª…ë ¹ì„ 2ê°œ í„°ë¯¸ë„ì—ì„œ ì‹¤í–‰

```sh
# exec
$ kubectl -n temp exec -it deploy/ab -- sh

$ ab -n 100000 -c 50 http://userlist-svc/users/1

```

| **ì˜µì…˜**  | **ì„¤ëª…**                          |
| --------- | --------------------------------- |
| -n 100000 | ì´ ìš”ì²­ íšŸìˆ˜                      |
| -c 50     | ë™ì‹œì— ë³´ë‚¼ ìš”ì²­ ìˆ˜ (concurrency) |





### (3) CPUì‚¬ìš©ìœ¨ í™•ì¸

```sh

$ kubectl top pod -n temp


# Prometheus ì¿¼ë¦¬
rate(container_cpu_usage_seconds_total{namespace="temp", container!="", pod=~"userlist.*"}[1m])


sum(rate(container_cpu_usage_seconds_total{namespace="temp", container!="", pod!=""}[1m])) by (pod)

```





## 3) Alert ë°œìƒ í™•ì¸

ì•„ë˜ì™€ ê°™ì´ 3ê°€ì§€ ë°©ë²•ìœ¼ë¡œ í™•ì¸ ê°€ëŠ¥í•˜ë‹¤.



### (1) alertmanager UI ì—ì„œ í™•ì¸

```sh
https://alertmanager.cbiz.kubepia.net

# â€œAlertsâ€ íƒ­ì—ì„œ HighCpuUsageë¼ëŠ” ì´ë¦„ì˜ ì•ŒëŒì´ ë–  ìˆìœ¼ë©´, Prometheusì—ì„œ ì¡°ê±´ì´ ì¶©ì¡±ë˜ì–´ Alertmanagerë¡œ ì „ë‹¬ë˜ì—ˆë‹¤ëŠ” ëœ»ì´ë‹¤.

```



### (2)  Prometheus UIì—ì„œ í™•ì¸

```sh
Alerts íƒ­ â†’ HighCpuUsage ê²½ê³ ê°€ â€œFIRINGâ€ ìƒíƒœì¸ì§€ í™•ì¸
	â€¢	â€œFiringâ€ì´ë©´ â†’ Alertmanagerë¡œ ì „ë‹¬ë¨



ALERTS{alertname="HighCpuUsage"}  ë¡œ ì¡°íšŒ
ALERTS{alertname="HighCpuUsage", alertstate="firing", pod="userlist-766cdd7986-9wxbp", severity="warning"}


```



### (3) ë¡œê·¸ë¡œ í™•ì¸

```sh
kubectl -n monitoring logs deploy/prom-stack-kube-prometheus-alertmanager

# ì•Œë¦¼ì´ ìˆ˜ì‹ ë˜ì—ˆëŠ”ì§€, ìˆ˜ì‹ ì(Webhook/Mattermost ë“±)ì— ì „ì†¡ë˜ì—ˆëŠ”ì§€ í™•ì¸ ê°€ëŠ¥
```







## 4) Mattermost ì•Œë¦¼ ë©”ì‹œì§€ ì˜ˆì‹œ



ê¸°ë³¸ ë©”ì‹œì§€ëŠ” ì•„ë˜ì™€ ìœ ì‚¬í•˜ê²Œ ì¶œë ¥ë¨

```
CPU ì‚¬ìš©ë¥  20% ì´ˆê³¼ (Pod: userlist-766cdd7986-9wxbp)
userlist-766cdd7986-9wxbpì˜ CPU ì‚¬ìš©ë¥ ì´ 20%ë¥¼ ì´ˆê³¼í–ˆìŠµë‹ˆë‹¤.




[FIRING] HighCpuUsage
summary: CPU ì‚¬ìš©ë¥  80% ì´ˆê³¼ (Pod: ap-pod-abc123)
description: ap-pod-abc123ì˜ CPU ì‚¬ìš©ë¥ ì´ 80%ë¥¼ ì´ˆê³¼í–ˆìŠµë‹ˆë‹¤.



```



# 6. Alertmanager ìƒíƒœ ì „ì´

Prometheus AlertmanagerëŠ” ì•Œë¦¼ ìƒíƒœì™€ íë¦„ì— ë”°ë¼ inactive â†’ pending â†’ firing â†’ resolved(ë³µêµ¬) ìƒíƒœë¡œ ì „ì´



| **ìƒíƒœ** | **ì„¤ëª…**                                                     |
| -------- | ------------------------------------------------------------ |
| inactive | ì¡°ê±´ì´ **ë§Œì¡±ë˜ì§€ ì•ŠìŒ**. ì¦‰, Alertê°€ ë°œìƒ ì¡°ê±´(expr)ì„ ë§Œì¡±í•˜ì§€ ì•ŠìŒ. |
| pending  | ì¡°ê±´ì„ ë§Œì¡±í–ˆì§€ë§Œ for:ë¡œ ì§€ì •í•œ **ì§€ì† ì‹œê°„**ì„ ì•„ì§ ì±„ìš°ì§€ ì•ŠìŒ. |
| firing   | ì¡°ê±´ì„ ì¼ì • ì‹œê°„ ì´ìƒ ë§Œì¡±í•´ì„œ **ê²½ê³ ê°€ ë°œì†¡ëœ ìƒíƒœ**.       |
| resolved | ì¡°ê±´ì´ ë” ì´ìƒ ë§Œì¡±ë˜ì§€ ì•Šì•„ **í•´ì œëœ ìƒíƒœ**. Mattermostì—ì„œëŠ” ì´ˆë¡ìƒ‰ ë©”ì‹œì§€ë¡œ í‘œì‹œë¨. |







**2. Alertmanagerì˜ route ì„¤ì • ê´€ë ¨ ì‹œê°„**

route:
  group_by: ["alertname"]
  group_wait: 30s         # ì²« Alertë¥¼ ëª¨ì•„ì„œ ë³´ë‚¼ ë•Œ ëŒ€ê¸° ì‹œê°„ (pending ìƒíƒœì¼ ìˆ˜ ìˆìŒ)
  group_interval: 5m      # ë™ì¼ ê·¸ë£¹ì—ì„œ ìƒˆ alertì´ ìƒê²¼ì„ ë•Œ ì¬ì „ì†¡ ëŒ€ê¸° ì‹œê°„
  repeat_interval: 4h     # firing ìƒíƒœê°€ ê³„ì† ìœ ì§€ë  ê²½ìš°, ë™ì¼ alert ì¬ì „ì†¡ ê°„ê²©,  resolved ìƒíƒœì´ë©´ í•´ì§€ë¨(ë‹¤ì‹œì‹œì‘)



| **í•­ëª©**        | **ì„¤ëª…**                                                     |
| --------------- | ------------------------------------------------------------ |
| group_wait      | ì•Œë¦¼ ê·¸ë£¹ì´ ì‹œì‘ëœ í›„ ì²« ì•Œë¦¼ì„ ë³´ë‚´ê¸° ì „ê¹Œì§€ì˜ ì‹œê°„         |
| group_interval  | ë™ì¼ ê·¸ë£¹ì— ìƒˆ ì•Œë¦¼ì´ ë°œìƒí•œ ê²½ìš°, ë‹¤ìŒ ì•Œë¦¼ ì „ì†¡ê¹Œì§€ ëŒ€ê¸° ì‹œê°„ |
| repeat_interval | ì•Œë¦¼ì´ firing ìƒíƒœì¼ ë•Œ ë°˜ë³µ ì „ì†¡ ê°„ê²© (ë¦¬ë§ˆì¸ë” ìš©ë„)       |